<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Marriage Connection Assessment — Couples (Ranked)</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&family=Merriweather:ital,wght@1,400;1,700&family=Great+Vibes&display=swap" rel="stylesheet">
<style>
  body { font-family: Arial, sans-serif; background:#FFF9F2; color:#1A3C5E; max-width: 980px; margin:auto; padding:20px; box-sizing:border-box; }
  h1,h2,h3,h4{ text-align:center; line-height:1.25; }
  .card { background:#fff; border:2px solid #4D9DE0; border-radius:12px; padding:24px; box-shadow:0 8px 25px rgba(0,0,0,.08); margin: 20px auto; }
  .btn, .answer-btn { background:#4D9DE0; color:#fff; font-weight:700; border:none; border-radius:8px; padding:12px 16px; cursor:pointer; margin:10px auto; display:block; width:100%; max-width:520px; }
  .btn:hover, .answer-btn:hover { background:#3A7FBF; }
  #backBtn { max-width:160px; padding:8px 12px; }
  .hidden{ display:none; }
  .progress-bar-container{ width:100%; max-width:520px; height:10px; background:#E0E0E0; border-radius:5px; margin:8px auto 4px; }
  .progress-bar{ height:100%; background:#FF4D4D; border-radius:5px; transition:width .25s; }
  .muted{ color:#9aa3ab; text-align:center; margin-top:12px; }
  .muted a:link, .muted a:visited { color:#9aa3ab; text-decoration:none; }
  .muted a:hover { color:#9aa3ab; text-decoration:underline; }

  /* Utility tweaks */
  .lh-13 { line-height: 1.3; }
  .mt-24pt { margin-top: 24pt !important; }

  /* Ranking UI */
  .rank-wrap { max-width: 760px; margin: 10px auto; }
  .rank-help { text-align:center; margin:8px 0 14px; }
  .rank-list { list-style:none; padding:0; margin:0; }
  .rank-item {
    display:flex; align-items:center; gap:10px;
    background:#fff; border:1px solid #4D9DE0; border-radius:8px;
    padding:10px 12px; margin:8px 0; cursor:grab;
  }
  .rank-item.dragging{ opacity:.6; }
  .rank-badge{ min-width:28px; height:28px; display:inline-flex; align-items:center; justify-content:center; border-radius:50%; background:#4D9DE0; color:#fff; font-weight:700; }
  .rank-title{ font-weight:700; }
  .rank-actions { margin-left:auto; display:flex; gap:6px; }
  .rank-actions button { padding:6px 10px; font-size:.9rem; border-radius:6px; border:1px solid #4D9DE0; background:#fff; color:#1A3C5E; cursor:pointer; }
  .rank-actions button:hover{ background:#f0f6ff; }

  /* Q buttons & pills */
  .question-box { background:#fff; border:1px solid #4D9DE0; border-radius:8px; padding:16px; margin:14px auto; max-width:760px; }
  .vertical-list .answer-btn{ margin:8px auto; max-width:760px; }
  .pill { display:inline-block; padding:8px 12px; border-radius:999px; border:1px solid #d0d7de; margin:6px; cursor:pointer; }
  .pill.selected{ background:#3A7FBF; border-color:#3A7FBF; color:#fff; }

  /* Results (highlighted cards) */
  .result-block { margin-bottom:16px; page-break-inside:avoid; padding:16px; border-left:8px solid #4D9DE0; border-radius:8px; background:#fff; line-height:1.3; }
  .section-title { color:#1A3C5E; font-family:'Open Sans',sans-serif; font-weight:700; font-size:16pt; margin-bottom:10px; }
  .subsection-title { color:#1A3C5E; font-family:'Roboto',sans-serif; font-weight:600; font-size:14pt; margin: 15px 0 8px; text-align:center; }
  .section-divider{ height:1pt; background-color:#FF4D4D; width:100%; max-width:860px; margin:24pt auto; }
  .subsection-divider{ height:1pt; background-color:rgba(77,157,224,.5); width:100%; max-width:860px; margin:14pt auto; }
  .verse{ font-family:'Merriweather', serif; font-style:italic; color:#FF4D4D; text-align:center; margin:4px auto 10px; max-width:820px; }
  .intro-text{ margin:8px auto 12px; line-height:1.45; }
  .couple-grid{ display:grid; grid-template-columns:1fr 1fr; gap:20px; align-items:start; position:relative; padding:10px 0; }
  .couple-grid::before{ content:""; position:absolute; left:50%; top:0; width:2px; height:100%; background:#4D9DE0; transform:translateX(-1px); }
  .partner-card{ border:none; }
  .partner-inner{ border-radius:12px; padding:8px; }
  .partner-header{ font-weight:700; text-align:center; margin-bottom:6px; }

  .results-list{ list-style-position:outside; margin-left:20px; text-align:left; }
  .results-list li{ margin-bottom:6px; }

  /* Discussion Prompts highlight = light blue */
  .prompt-block {
    border-left:8px solid #4D9DE0;
    background: rgba(77,157,224,0.08);
    border-radius:8px; padding:16px; margin:16px 0;
  }

  .partner-subhead{ text-align:center; margin:6px 0 6px; }

  /* “Thank You” title — larger, centered, reduced spacing; scales on mobile */
  .thank-title{
    margin-top:0;
    margin-bottom:12pt;       /* requested smaller space below */
    font-family:'Savoye LET','Zapfino','Great Vibes',cursive;
    color:#4D9DE0;
    font-size:4.4rem;         /* desktop size (twice as big) */
    line-height:1.1;
    text-align:center;
  }
  @media (max-width:700px){
    .couple-grid{ grid-template-columns:1fr; }
    .couple-grid::before{ display:none; }
    .thank-title{ font-size:3.2rem; }   /* scale down on tablets/phones */
  }
  @media (max-width:420px){
    .thank-title{ font-size:2.6rem; }   /* further reduce for small phones */
  }
</style>
</head>
<body>

<!-- Intro -->
<div id="introPage" class="card">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h1>Your Guide to a Deeper Connection</h1>
  <div class="intro-text">
    <p style="text-align:center;"><em>Ready for a few “aha!” moments together?</em></p>
    <p>This is a moment for the two of you to connect. You’ll each take a few minutes to share your perspective on what builds intimacy and how you navigate daily life as a couple.</p>
    <p>When you're both done, you'll see your combined results with fun insights and practical ideas to support each other even better.</p>

    <p style="margin-bottom:0.2em;"><strong>How it works:</strong></p>
    <div class="lh-13" style="margin-top:0;">
      <p style="margin:0;">Pick someone to go first. When they're finished, hand the device over to your partner. Easy!</p>
    </div>
  </div>
  <div class="row mt-24pt" style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap;">
    <input id="partnerAName" class="input" placeholder="Partner A name" aria-label="Partner A name" style="border:1px solid #4D9DE0; border-radius:8px; padding:10px 12px; min-width:220px;">
    <input id="partnerBName" class="input" placeholder="Partner B name" aria-label="Partner B name" style="border:1px solid #4D9DE0; border-radius:8px; padding:10px 12px; min-width:220px;">
  </div>
  <button id="startBtn" class="btn" style="max-width:260px;">Start Couples Assessment</button>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<!-- Quiz -->
<div id="quizPage" class="card hidden">
  <h2 id="quizTitle">Assessment</h2>
  <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
  <div id="progress" style="text-align:center; margin-bottom:8px;"></div>
  <div id="questionContainer" class="question-box"></div>
  <div style="display:flex; gap:10px; justify-content:center;">
    <button id="backBtn" class="btn" style="display:none; max-width:160px;">Back</button>
  </div>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<!-- Results -->
<div id="resultPage" class="card hidden">
  <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png" alt="Logo" style="display:block; margin:0 auto 12px; max-width:200px;" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'">
  <h2 id="resultsHeader">Your Marriage Connection Profile</h2>
  <div id="resultsIntro" class="intro-text">
    <p>Welcome to the Marriage Connection Assessment, a guided experience designed to help you and your spouse build a covenant, joy-filled marriage as God designed.</p>
    <p>This is your personalized guide to understanding each other in a new way. Think of this not as a set of labels, but as a living map to the unique landscape of your relationship—it helps you name what’s true today and aim for what’s possible tomorrow.</p>
  </div>
  <div id="results"></div>
  <p class="muted"><a href="https://happymarriagehappylife.com" target="_blank" rel="noopener">HappyMarriageHappyLife.com</a></p>
</div>

<script>
/* ================== Data ================== */
const INTIMACY = {
  Spiritual:{label:"Spiritual Intimacy", desc:"Spiritual intimacy is the shared sense of purpose and connection to God’s design that anchors a relationship. It’s the core that shapes how love is experienced and expressed, guiding your journey together."},
  Emotional:{label:"Emotional Intimacy", desc:"Emotional intimacy is the key to deep connection, creating a safe space for vulnerability and empathy. This crucial bond is the gateway that allows all other forms of closeness to flourish."},
  Commitment:{label:"Commitment Intimacy", desc:"Commitment intimacy is the security and dedication that acts as the core of a relationship, providing the stability needed to weather life’s storms. This dedicated bond is what allows a couple to face challenges and deepen their connection over time."},
  Intellectual:{label:"Intellectual Intimacy", desc:"Intellectual intimacy is about sharing a mental and emotional connection through engaging conversations and mutual respect for each other’s thoughts and values. It builds a powerful bond forged by the exchange of ideas and the exploration of new perspectives."},
  Affable:{label:"Affable Intimacy", desc:"Affable intimacy is the ease and comfort found in a relationship, creating a peaceful and enjoyable environment. It’s the simple joy of being agreeable and easygoing in your daily interactions with each other."},
  Conflict:{label:"Conflict Intimacy", desc:"Conflict intimacy is the ability to maintain a strong connection and mutual respect even during disagreements. It allows couples to navigate differences and grow closer through the process of resolving conflicts together."},
  Recreational:{label:"Recreational Intimacy", desc:"Recreational intimacy is about sharing laughter, playfulness, and joy through shared hobbies and experiences. It brings vitality and fun to a relationship, creating cherished memories that strengthen the bond."},
  Partnership:{label:"Partnership Intimacy", desc:"Partnership intimacy is the collaborative connection built by working together to manage daily responsibilities and make decisions. This forges a powerful bond as a couple functions as a unified team, tackling life’s challenges side by side."},
  Stability:{label:"Financial Intimacy (Stability)", desc:"Stability intimacy is about transparently and honestly managing resources like time and money together, building a foundation of trust and a secure future. It’s a shared commitment to aligning your values as you work toward a common goal."},
  Creative:{label:"Creative Intimacy", desc:"Creative intimacy is the shared joy of bringing new ideas to life by building and dreaming together. This bond is strengthened through the process of collaborating on projects and seeing your shared vision become a reality."},
  Physical:{label:"Physical Intimacy", desc:"Physical intimacy involves connecting through non-sexual touch, comfort, and physical presence. This kind of closeness creates a sense of safety and security, affirming your bond through simple gestures and shared moments."},
  Sexual:{label:"Sexual Intimacy", desc:"Sexual intimacy is a passionate, exclusive, and sacred physical union that expresses a deep, committed connection. It’s a unique and powerful way to honor your bond through a shared experience of vulnerability and pleasure."}
};
const TYPES = Object.keys(INTIMACY);

const typeColors = {
  Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347",
  Intellectual:"#4C6B9B", Affable:"#FFB6C1", Recreational:"#4DD2FF",
  Partnership:"#3CB371", Stability:"#FFD700", Creative:"#FF66CC",
  Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946"
};
const typeOpac = {
  Spiritual:"rgba(106,76,147,.08)", Emotional:"rgba(255,122,112,.08)", Commitment:"rgba(255,179,71,.08)",
  Intellectual:"rgba(76,107,155,.08)", Affable:"rgba(255,182,193,.08)", Recreational:"rgba(77,210,255,.08)",
  Partnership:"rgba(60,179,113,.08)", Stability:"rgba(255,215,0,.08)", Creative:"rgba(255,102,204,.08)",
  Conflict:"rgba(255,165,82,.08)", Physical:"rgba(255,140,105,.08)", Sexual:"rgba(230,57,70,.08)"
};

const scripture = {
  coreStrengths: "“Above all, love each other deeply, because love covers over a multitude of sins.” — 1 Peter 4:8",
  areasForGrowth: "“Let us consider how we may spur one another on toward love and good deeds.” — Hebrews 10:24",
  untappedOpps: "“See, I am doing a new thing! … Do you not perceive it?” — Isaiah 43:19",

  compassionCare: "“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2",
  socialEngagement: "“Therefore encourage one another and build each other up.” — 1 Thessalonians 5:11",
  decisionLeadership: "“If any of you lacks wisdom, you should ask God … and it will be given to you.” — James 1:5",
  respectRecognition: "“Honor one another above yourselves.” — Romans 12:10",
  connectionPattern: "“Make every effort to keep the unity of the Spirit through the bond of peace.” — Ephesians 4:3",
  conflictStrategies: "“Everyone should be quick to listen, slow to speak and slow to become angry.” — James 1:19",
  thankYou: "“May the Lord make your love increase and overflow for each other and for everyone else, just as ours does for you.” — 1 Thessalonians 3:12"
};

/* Temperament accent mapping (Sanguine/Choleric/Melancholy/Phlegmatic/Supine) */
function temperamentAccentFromKey(k){
  const map = {
    E: { color: typeColors.Emotional,    bg: typeOpac.Emotional    }, // Sanguine
    S: { color: typeColors.Commitment,   bg: typeOpac.Commitment   }, // Choleric
    R: { color: typeColors.Intellectual, bg: typeOpac.Intellectual }, // Melancholy
    A: { color: typeColors.Affable,      bg: typeOpac.Affable      }, // Phlegmatic
    U: { color: typeColors.Partnership,  bg: typeOpac.Partnership  }  // Supine
  };
  return map[k] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" };
}
function temperamentAccentFromAffKey(k){
  const t = { Playful:"E", Initiative:"S", DeepTalk:"R", Warmth:"A", Support:"U" }[k];
  return temperamentAccentFromKey(t);
}

/* Rich copy for Compassion & Care */
const affEXP = {
  Playful: "You naturally lift the mood with humor, lightness, and spontaneous moments that say, “I’m with you.” You turn ordinary spaces into warm, safe places.",
  Initiative: "You show love by stepping in and taking pressure off—solving problems, removing obstacles, and protecting what matters to your spouse.",
  DeepTalk: "You invite depth—lingering in meaningful conversation, asking curious questions, and making your spouse feel profoundly understood.",
  Warmth: "You offer steady presence and gentle affection. Your calming tone, touch, and attention help your spouse exhale and feel safe.",
  Support: "You love through action: pitching in, following through, and sharing the load. Your reliability says, “You’re not alone—I'm with you.”"
};
const affDES = {
  Playful: "You feel loved when your spouse keeps things light, playful, and hope-filled—like a breath of fresh air when life feels heavy.",
  Initiative: "You feel most cared for when your spouse takes initiative—removing stress, solving a problem, or leading with strength and protection.",
  DeepTalk: "You feel cherished when your spouse slows down, listens deeply, and engages your thoughts and heart with focused, meaningful time.",
  Warmth: "You feel secure with gentle presence, unhurried attention, and comforting touch that says, “I’m here, and you matter.”",
  Support: "You feel honored when your spouse helps practically—sharing responsibilities and showing up consistently in the daily things."
};

/* Social/Decision details */
const temperamentDetails = {
  E: { looks:"You energize the room and move things forward with enthusiasm.",
       watch:"Fast pace can out-run deeper needs or quieter voices.",
       tip:"Schedule both lively connection and quiet check-ins to stay balanced." },
  S: { looks:"You provide direction, set goals, and protect progress.",
       watch:"Decisiveness can feel controlling if not co-authored.",
       tip:"Invite input early and name where you’re flexible." },
  R: { looks:"You think deeply, ask great questions, and value thoughtfulness.",
       watch:"Over-analysis can delay decisions or feel distant.",
       tip:"Time-box decisions and surface feelings—not just facts." },
  A: { looks:"You bring calm, keep the peace, and reduce friction.",
       watch:"Avoiding tension can postpone needed clarity.",
       tip:"Name one concrete next step even when keeping it gentle." },
  U: { looks:"You serve steadily, include others, and build trust.",
       watch:"Understating your needs can lead to quiet resentment.",
       tip:"Voice one specific need and one boundary you appreciate." }
};

/* Conversational details for Section 3 */
const patternDetail = {
  SteadyConnector: {
    connectionType: "Harmony-focused and steady—your presence calms the room and keeps connection safe.",
    strengths: "create a peaceful space where hard conversations feel possible. You’re consistent, fair, and great at lowering tension.",
    challenges: "can move past issues too quickly or downplay your own needs to keep the peace, which can leave things unresolved.",
    tendencies: "In conflict, you often smooth things over fast and avoid going deep, hoping the calm will hold.",
    coping: "Try a 5–10 minute daily check-in. Name one feeling and one specific need before you move to solutions."
  },
  ReassuranceSeeker: {
    connectionType: "Attachment-aware and passionate—you lead with heart and crave clarity when things feel off.",
    strengths: "fight for closeness and speak up when something feels wrong. You’re empathetic and quick to repair.",
    challenges: "needing reassurance now can feel intense to your spouse and escalate emotions if you don’t get it quickly.",
    tendencies: "In conflict, you pursue answers and closeness immediately, which can feel like pressure to a withdrawing partner.",
    coping: "Ask for one clear reassurance, breathe together, then agree to a short reset with a promised return time."
  },
  IndependentConnector: {
    connectionType: "Thoughtful and composed—you value clarity and reflection to keep connection honest and stable.",
    strengths: "think before you speak, de-escalate well, and protect against saying things you don’t mean.",
    challenges: "taking space without clarity can feel like distance or shutdown to your spouse.",
    tendencies: "In conflict, you step back to think. Without a return time, that pause can be heard as disconnection.",
    coping: "Request space with a specific return time (e.g., 30 minutes). Offer one sentence of reassurance first."
  },
  GuardedConnector: {
    connectionType: "Careful and loyal—you open slowly and build trust through consistency.",
    strengths: "are dependable and don’t overreact. When you commit, you show up.",
    challenges: "caution can look like walls. It’s easy to assume negative intent and protect rather than share.",
    tendencies: "In conflict, you may go quiet, assume the worst, or agree just to end it—then carry the weight alone.",
    coping: "Use micro-trust steps: keep one small promise daily, write a short note before hard talks, and name one safe topic to open."
  }
};

/* Personalized sentence (FromName → ToName) based on receiver’s pattern */
function nameStrategy(fromName, toName, bondingKey){
  const base = {
    SteadyConnector: `${fromName}, try approaching ${toName} by keeping the tone gentle but staying with one feeling and one specific need before you move to solutions.`,
    ReassuranceSeeker: `${fromName}, try approaching ${toName} by asking for one clear reassurance first, then suggesting a short pause with a promised return time.`,
    IndependentConnector: `${fromName}, try approaching ${toName} by reassuring them with one sentence, then requesting a brief thinking break and naming exactly when you’ll return.`,
    GuardedConnector: `${fromName}, try approaching ${toName} by starting small—share one truth you feel safe to say, then invite a next step you can both agree on.`
  };
  return base[bondingKey];
}

/* Concise repair tips */
const patternExtras = {
  SteadyConnector: "Use a short daily “check-in” ritual so small tensions resolve early.",
  ReassuranceSeeker: "Ask for a specific reassurance, then pause to prevent spirals.",
  IndependentConnector: "Set a clear return time after space to avoid disconnection.",
  GuardedConnector: "Start with micro-trust steps before heavier talks."
};

/* 2×2 conflict strategies text (for practical tip line) */
const conflictStrategies = {
  SteadyConnector: {
    SteadyConnector: "Use weekly check-ins to catch small tensions early.",
    ReassuranceSeeker: "Offer explicit reassurance first, then discuss calmly.",
    IndependentConnector: "Give brief space, then return at an agreed time.",
    GuardedConnector: "Slow the pace; invite one small truth at a time."
  },
  ReassuranceSeeker: {
    SteadyConnector: "Ask for one clear reassurance, then breathe together.",
    ReassuranceSeeker: "Time-box mutual reassurance to prevent spirals.",
    IndependentConnector: "Request one sentence of reassurance before space.",
    GuardedConnector: "Use gentle, concrete requests—no rapid-fire questions."
  },
  IndependentConnector: {
    SteadyConnector: "Explain your need for reflection; set a return time.",
    ReassuranceSeeker: "Offer quick assurance first, then reflect briefly.",
    IndependentConnector: "Agree on a pause-and-return window you both keep.",
    GuardedConnector: "Use structured check-ins; keep tone steady."
  },
  GuardedConnector: {
    SteadyConnector: "Share gradually; acknowledge their harmony focus.",
    ReassuranceSeeker: "Offer small affirmations to reduce anxiety.",
    IndependentConnector: "Blend caution with steady pacing and check-ins.",
    GuardedConnector: "Build trust with daily micro-keeps before hard topics."
  }
};

/* ================== Flow/State ================== */
let partnerAName="", partnerBName="";
let partnerIndex = 0; // 0 = A, 1 = B
const TOTAL_STEPS = 13;
let step = 0;
let resultsShown = false;  /* guard: results render once */

/* per-partner answers */
let answers = {
  rank: [...TYPES],
  expressedTop2: [],
  desiredTop2: [],
  social: {},
  decision: {},
  rr: { rr1:null, rr2:null },
  bond: {}
};

const profiles = [];

/* ================== Boot ================== */
document.getElementById('startBtn').onclick = () => {
  partnerAName = document.getElementById('partnerAName').value.trim();
  partnerBName = document.getElementById('partnerBName').value.trim();
  if(!partnerAName || !partnerBName){ alert("Please enter both Partner A and Partner B names to begin."); return; }
  startPartner(0);
};
document.getElementById('backBtn').onclick = () => { if(step>0){ step--; renderStep(); } };

function hideAllPages(){
  document.getElementById('introPage').classList.add('hidden');
  document.getElementById('quizPage').classList.add('hidden');
  document.getElementById('resultPage').classList.add('hidden');
}
function startPartner(idx){
  partnerIndex = idx;
  resetAnswers();
  hideAllPages();
  document.getElementById('quizPage').classList.remove('hidden');
  document.getElementById('quizTitle').textContent = `Assessment — ${idx===0?partnerAName:partnerBName}`;
  step = 0;
  renderStep();
}
function resetAnswers(){
  answers = { rank:[...TYPES], expressedTop2:[], desiredTop2:[], social:{}, decision:{}, rr:{ rr1:null, rr2:null }, bond:{} };
}

/* ================== Render Steps ================== */
function renderStep(){
  document.getElementById('progress').textContent = `Step ${step+1} of ${TOTAL_STEPS}`;
  document.getElementById('progressBar').style.width = `${((step+1)/TOTAL_STEPS)*100}%`;
  const box = document.getElementById('questionContainer');
  box.innerHTML = "";
  document.getElementById('backBtn').style.display = step>0 ? 'block' : 'none';

  if(step===0) return renderRankUI(box);
  if(step===1) return renderPick2(box, "How you give love — choose your Top 2", "expressedTop2");
  if(step===2) return renderPick2(box, "How you feel most loved — choose your Top 2", "desiredTop2");
  if(step===3) return renderSingleList(box, "In groups, I usually…", [
    ["E","Bring energy and get people talking."],
    ["S","Organize or give structure to the time."],
    ["R","Connect deeply with one or two people."],
    ["A","Keep it light, calm, and agreeable."],
    ["U","Make sure everyone feels included."]
  ], key => { answers.social["social1"]=key; next(); });
  if(step===4) return renderSingleList(box, "Planning social time, I prefer we…", [
    ["E","Pick lively, people-filled activities."],
    ["S","Set a plan and keep on track."],
    ["R","Prioritize meaningful, low-key connection."],
    ["A","Keep it relaxed and pressure-free."],
    ["U","Consider others and include them thoughtfully."]
  ], key => { answers.social["social2"]=key; next(); });
  if(step===5) return renderSingleList(box, "When a decision is needed, I tend to…", [
    ["E","Choose the fun option and keep momentum."],
    ["S","Decide quickly and set direction."],
    ["R","Analyze details before choosing."],
    ["A","Seek harmony and avoid friction."],
    ["U","Support the plan and contribute steadily."]
  ], key => { answers.decision["decision1"]=key; next(); });
  if(step===6) return renderSingleList(box, "On shared projects at home, I usually…", [
    ["E","Keep things upbeat and moving."],
    ["S","Take the lead and drive results."],
    ["R","Plan details and set a thoughtful pace."],
    ["A","Stay flexible and avoid conflict."],
    ["U","Pitch in steadily and support the plan."]
  ], key => { answers.decision["decision2"]=key; next(); });
  if(step===7) return renderSingleList(box, "I feel my opinions are respected in our relationship.", [
    [3,"Strongly Agree"], [2,"Agree"], [1,"Disagree"], [0,"Strongly Disagree"]
  ], val => { answers.rr.rr1 = Number(val); next(); });
  if(step===8) return renderSingleList(box, "We are aligned on core values and honor our covenant.", [
    [3,"Strongly Agree"], [2,"Agree"], [1,"Disagree"], [0,"Strongly Disagree"]
  ], val => { answers.rr.rr2 = Number(val); next(); });
  if(step===9) return renderSingleList(box, "During conflict, I naturally…", [
    ["SteadyConnector","Use humor to lower tension."],
    ["ReassuranceSeeker","Push for quick resolution."],
    ["IndependentConnector","Withdraw to think it through."],
    ["IndependentConnector","Stay calm to avoid escalation."],
    ["GuardedConnector","Concede just to end it."]
  ], key => { answers.bond["bond1"]=key; next(); });
  if(step===10) return renderSingleList(box, "When I feel unappreciated, I tend to…", [
    ["SteadyConnector","Laugh it off and move on."],
    ["ReassuranceSeeker","Remind my spouse of my effort."],
    ["IndependentConnector","Feel overlooked and pull back."],
    ["IndependentConnector","Let it go to keep peace."],
    ["GuardedConnector","Feel hurt and shut down."]
  ], key => { answers.bond["bond2"]=key; next(); });
  if(step===11) return renderSingleList(box, "After a disagreement, I prefer to…", [
    ["ReassuranceSeeker","Repair quickly together."],
    ["IndependentConnector","Pause, then reconnect with a plan."]
  ], key => { answers.bond["bond3"]=key; next(); });
  if(step===12) return renderSingleList(box, "When overwhelmed, I prefer to…", [
    ["ReassuranceSeeker","Seek closeness and reassurance now."],
    ["IndependentConnector","Have space first, then return to talk."]
  ], key => { answers.bond["bond4"]=key; finalizePartner(); });
}

/* ---------- Step 0: Ranking ---------- */
function renderRankUI(root){
  const wrap = document.createElement('div');
  wrap.className = 'rank-wrap';
  wrap.innerHTML = `
    <h3 style="text-align:center;">Rank the 12 Intimacy Types</h3>
    <p class="rank-help">Drag to reorder (or use ↑ / ↓). Place your most important at the top.</p>
    <ul id="rankList" class="rank-list"></ul>
    <button id="rankContinue" class="btn" style="max-width:260px;">Save Ranking & Continue</button>
  `;
  root.appendChild(wrap);

  const ul = wrap.querySelector('#rankList');
  refreshRankList(ul);

  let dragEl = null;
  ul.addEventListener('dragstart', e=>{
    if(e.target.classList.contains('rank-item')){
      dragEl = e.target; e.dataTransfer.effectAllowed='move'; e.target.classList.add('dragging');
    }
  });
  ul.addEventListener('dragend', e=>{ if(dragEl){ dragEl.classList.remove('dragging'); dragEl=null; }});
  ul.addEventListener('dragover', e=>{
    e.preventDefault();
    const after = getDragAfterElement(ul, e.clientY);
    const dragging = ul.querySelector('.dragging');
    if(!dragging) return;
    if(after==null) ul.appendChild(dragging); else ul.insertBefore(dragging, after);
  });
  ul.addEventListener('drop', ()=>{ answers.rank = [...ul.querySelectorAll('.rank-item')].map(li=>li.dataset.key); refreshRankList(ul); });

  function getDragAfterElement(container, y){
    const els = [...container.querySelectorAll('.rank-item:not(.dragging)')];
    return els.reduce((closest, child)=>{
      const box = child.getBoundingClientRect();
      const offset = y - box.top - box.height/2;
      if(offset<0 && offset>closest.offset) return {offset, element:child};
      else return closest;
    }, {offset: Number.NEGATIVE_INFINITY}).element;
  }

  document.getElementById('rankContinue').onclick = ()=>{
    answers.rank = [...ul.querySelectorAll('.rank-item')].map(li=>li.dataset.key);
    if(answers.rank.length!==12){ alert("Please rank all 12 types."); return; }
    next();
  };
}
function refreshRankList(ul){
  ul.innerHTML = "";
  answers.rank.forEach((k, idx)=>{
    const li = document.createElement('li');
    li.className = 'rank-item';
    li.draggable = true;
    li.dataset.key = k;
    li.innerHTML = `
      <span class="rank-badge">${idx+1}</span>
      <div>
        <div class="rank-title">${INTIMACY[k].label}</div>
        <div style="font-size:.9rem;color:#4a607a;">${INTIMACY[k].desc}</div>
      </div>
      <div class="rank-actions">
        <button type="button" aria-label="Move up">↑</button>
        <button type="button" aria-label="Move down">↓</button>
      </div>
    `;
    const [upBtn, downBtn] = li.querySelectorAll('.rank-actions button');
    upBtn.onclick = () => {
      const i = answers.rank.indexOf(k);
      if(i>0){ [answers.rank[i-1], answers.rank[i]] = [answers.rank[i], answers.rank[i-1]]; refreshRankList(ul); }
    };
    downBtn.onclick = () => {
      const i = answers.rank.indexOf(k);
      if(i<answers.rank.length-1){ [answers.rank[i+1], answers.rank[i]] = [answers.rank[i], answers.rank[i+1]]; refreshRankList(ul); }
    };
    ul.appendChild(li);
  });
}

/* ---------- Pick-2 (steps 1–2) ---------- */
const affectionOptions = [
  {key:"Playful", text:"Playful moments and upbeat encouragement"},
  {key:"Initiative", text:"Taking initiative—removing stressors"},
  {key:"DeepTalk", text:"Deep conversation and focused time"},
  {key:"Warmth", text:"Warm presence and gentle touch"},
  {key:"Support", text:"Practical help and steady teamwork"}
];
function renderPick2(root, title, field){
  const selected = answers[field];
  const div = document.createElement('div');
  div.innerHTML = `<h3 style="text-align:center;">${title}</h3>
    <p class="rank-help">Tap to select two. Your first tap is #1, second is #2. Tap again to unselect.</p>
    <div id="pick2Wrap" style="text-align:center;"></div>
    <p style="text-align:center; margin-top:8px;">Selected: <strong>${selected.map((k,i)=>`${i+1}. ${labelFor(k)}`).join("  ")||"—"}</strong></p>`;
  root.appendChild(div);
  const wrap = div.querySelector('#pick2Wrap');
  affectionOptions.forEach(o=>{
    const pill = document.createElement('span');
    pill.className = 'pill' + (selected.includes(o.key) ? ' selected' : '');
    pill.textContent = o.text;
    pill.onclick = ()=>{
      if(selected.includes(o.key)){
        answers[field] = selected.filter(x=>x!==o.key);
        renderStep();
      }else{
        if(selected.length<2){
          answers[field] = [...selected, o.key];
          if(answers[field].length===2) return next();
          renderStep();
        }
      }
    };
    wrap.appendChild(pill);
  });
}
function labelFor(k){
  return {Playful:"Playful moments", Initiative:"Taking initiative", DeepTalk:"Deep conversation", Warmth:"Warm presence & touch", Support:"Practical support"}[k]||k;
}

/* ---------- Single-choice helper ---------- */
function renderSingleList(root, title, options, onPick){
  root.innerHTML = `<h3 style="text-align:center;">${title}</h3><div class="vertical-list"></div>`;
  const v = root.querySelector('.vertical-list');
  options.forEach(([val, txt])=>{
    const b = document.createElement('button');
    b.className = 'answer-btn';
    b.textContent = txt;
    b.onclick = ()=> onPick(val);
    v.appendChild(b);
  });
}
function next(){ step++; if(step<TOTAL_STEPS) renderStep(); else finalizePartner(); }

/* ================== Build profile & results ================== */
function finalizePartner(){
  const name = partnerIndex===0 ? partnerAName : partnerBName;

  const socialCounts = {E:0,S:0,R:0,A:0,U:0}; Object.values(answers.social).forEach(k=> socialCounts[k]++);
  const decisionCounts = {E:0,S:0,R:0,A:0,U:0}; Object.values(answers.decision).forEach(k=> decisionCounts[k]++);
  const socialTop = Object.entries(socialCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;
  const decisionTop = Object.entries(decisionCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || null;

  const socialSummary = socialTop ? ({
    E:"You bring energy and enthusiasm to social settings.",
    S:"You give structure and help lead groups well.",
    R:"You prefer deep, thoughtful conversations.",
    A:"You value calm, low-key connection.",
    U:"You make sure others feel included and cared for."
  })[socialTop] : "You adapt flexibly to different situations.";

  const decisionSummary = decisionTop ? ({
    E:"You decide with enthusiasm, prioritizing enjoyment and momentum.",
    S:"You decide decisively, goal-first.",
    R:"You analyze carefully before choosing.",
    A:"You seek harmony and consensus.",
    U:"You steadily support plans and shared goals."
  })[decisionTop] : "You adapt flexibly to different situations.";

  const rrScore = (answers.rr.rr1 ?? 0) + (answers.rr.rr2 ?? 0);
  const rrLabel = rrScore>=5 ? "Strong" : rrScore>=3 ? "Moderate" : "Needs Attention";

  const bondCounts = {SteadyConnector:0, ReassuranceSeeker:0, IndependentConnector:0, GuardedConnector:0};
  Object.values(answers.bond).forEach(k=> bondCounts[k]++);
  const bondingKey = Object.entries(bondCounts).sort((a,b)=>b[1]-a[1])[0]?.[0] || "SteadyConnector";

  const profile = {
    name,
    coreTypes: answers.rank.slice(0,4),
    growthTypes: answers.rank.slice(4,8),
    untappedTypes: answers.rank.slice(8,12),
    expressedTop2: [...answers.expressedTop2],
    desiredTop2: [...answers.desiredTop2],
    socialTop, decisionTop, socialSummary, decisionSummary,
    rrScore, rrLabel, bondingKey
  };

  if (partnerIndex === 0) {
    profiles[0] = profile;
    document.getElementById('quizPage').classList.add('hidden');
    document.getElementById('resultPage').classList.remove('hidden');
    document.getElementById('resultsHeader').textContent = "Your Marriage Connection Profile";
    document.getElementById('results').innerHTML = `
      <div class="result-block" style="text-align:center;">
        <h3 class="section-title" style="margin-top:0;">Thank you, ${name}!</h3>
        <p class="intro-text">Please pass the device to <strong>${partnerBName}</strong> to complete their part. We’ll show both results side-by-side.</p>
        <button class="btn" style="max-width:240px;" onclick="startPartner(1)">Start Partner B</button>
      </div>
    `;
  } else {
    profiles[1] = profile;
    if (!resultsShown) {
      resultsShown = true;
      renderResults();
    }
  }
}

/* ---------- Results Renderer ---------- */
function renderResults(){
  document.getElementById('quizPage').classList.add('hidden');
  document.getElementById('resultPage').classList.remove('hidden');
  document.getElementById('resultsHeader').textContent = "Your Marriage Connection Profile";

  const A = profiles[0], B = profiles[1];
  const container = document.createElement('div');
  container.id = "couplesReport";

  /* ===== Section 1 ===== */
  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 1: Your Intimacy Preferences</h3>
    <div class="intro-text">
      This section is all about understanding intimacy—the profound experience of being truly known, deeply connected, and fully cherished by your spouse. It reveals your unique connection profile, showing how you naturally express love and how you feel most loved in return.
      <p>Our model organizes intimacy into 12 distinct types that span all dimensions of human experience, wisely combining the essential aspects of <em>“being together”</em> (like emotional bonding and spiritual connection) and <em>“doing together”</em> (like shared effort and practical unity). This approach reflects how love truly thrives in real-life marriage. These types represent crucial points of connection (and sometimes conflict) in your relationship, and understanding your preferences gives you and your spouse a shared language to express your needs and navigate your connection. Think of your results as a vibrant guide to your relationship’s most rewarding pathways.</p>
    </div>

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Core Connection Strengths</h4>
    <div class="verse">${scripture.coreStrengths}</div>
    <p class="intro-text">Based on your unique profile, these are your most fulfilling and effortless pathways to deeper closeness. They highlight your natural strengths and the incredible ways you both genuinely thrive.</p>
    <div class="couple-grid">
      ${typesColumn(A.name, A.coreTypes)}
      ${typesColumn(B.name, B.coreTypes)}
    </div>
    ${promptsBlock([
      "<em>Explore:</em> Share why each strength matters and when you feel most connected in that way.",
      "<em>Be Creative:</em> Trade ideas to practice one of your spouse’s strengths this week, then pick one.",
      "<em>Share:</em> What did you learn about how your spouse feels most connected?"
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Areas for Growth</h4>
    <div class="verse">${scripture.areasForGrowth}</div>
    <p class="intro-text">You’ll find these areas are truly wonderful opportunities for intentional focus. With just a bit of practice and presence, you can absolutely deepen your connection in these types of intimacy.</p>
    <div class="couple-grid">
      ${typesColumn(A.name, A.growthTypes)}
      ${typesColumn(B.name, B.growthTypes)}
    </div>
    ${promptsBlock([
      "<em>My Perspective:</em> Which growth area feels most fun to try this week?",
      "<em>Your Perspective:</em> What’s one specific, positive thing I could do to support you?",
      "<em>Just for Fun:</em> Design a “growth date” that includes one shared growth area."
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Your Untapped Opportunities</h4>
    <div class="verse">${scripture.untappedOpps}</div>
    <p class="intro-text">These aren’t weaknesses at all—think of them as exciting, untapped gifts for you to discover as a couple. Embracing these new avenues of connection can add surprising depth and vibrant excitement to your marriage.</p>
    <div class="couple-grid">
      ${typesColumn(A.name, A.untappedTypes)}
      ${typesColumn(B.name, B.untappedTypes)}
    </div>
    ${promptsBlock([
      "<em>Be a Pioneer:</em> Which lowest-scored type feels most intriguing?",
      "<em>First Step:</em> Choose one small way to try it this week.",
      "<em>Share Your Heart:</em> What might it mean to grow here?"
    ])}
  `;

  /* ===== Section 2 ===== */
  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 2: Relational Dynamics</h3>
    <div class="intro-text">
      Your relationship isn’t just a connection of two people; it’s a unique dance of two beautiful, distinct individuals! This section is designed to help you understand the everyday rhythms that shape your connection.
    </div>

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Compassion & Care</h4>
    <div class="verse">${scripture.compassionCare}</div>
    <p class="intro-text">This dynamic delves into the heart of your relationship: how love, empathy, and emotional needs are expressed and received. It reveals your unique capacity for tenderness, emotional availability, nurturing, and presence. At its core, this is where you answer the profound question, <em>“Do you care about me?”</em>—both in how you show up for your spouse and how you long to receive comfort and support in return. Understanding this area helps you both ensure your hearts feel truly seen and safe.</p>
    <div class="couple-grid">
      ${compassionColumn(A)}
      ${compassionColumn(B)}
    </div>
    ${promptsBlock([
      "<em>A \\\"Love Note\\\" to Each Other:</em> Using your spouse’s “receive love” picks, write a one-sentence appreciation you’ll do this week.",
      "<em>A Curious Question:</em> “What’s one small thing I could do today that would help you feel especially cared for?”"
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Social Preferences</h4>
    <div class="verse">${scripture.socialEngagement}</div>
    <p class="intro-text">This dynamic is all about how you both recharge and engage with the world around you. It explores whether you feel energized by being with others (extraversion), find deep renewal in solitude (introversion), or perhaps thrive with a mix of both (<em>ambiversion</em>). Understanding these unique preferences is key to helping you beautifully balance connection and personal space.</p>
    ${temperamentBlock(A.name, "Your Social Energy", buildTemperamentText(A.socialTop, A.socialSummary), A.socialTop)}
    ${temperamentBlock(B.name, "Your Social Energy", buildTemperamentText(B.socialTop, B.socialSummary), B.socialTop)}
    ${promptsBlock([
      "<em>The Best of Both Worlds:</em> Share one activity that energizes you with people and one that renews you in quiet.",
      "<em>A \\\"We & Me\\\" Plan:</em> Pick one together-activity and one solo recharge this week."
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Power & Control</h4>
    <div class="verse">${scripture.decisionLeadership}</div>
    <p class="intro-text">This dynamic explores how you navigate decisions and leadership within your relationship, and how you approach influence and authority. It’s about how decisions are made, roles are shared, and influence is balanced. Understanding this helps you create a structure where shared responsibility and collaboration feel both respectful and safe.</p>
    ${temperamentBlock(A.name, "Your Leadership Style", buildTemperamentText(A.decisionTop, A.decisionSummary), A.decisionTop)}
    ${temperamentBlock(B.name, "Your Leadership Style", buildTemperamentText(B.decisionTop, B.decisionSummary), B.decisionTop)}
    ${promptsBlock([
      "<em>A Shared Decision:</em> Choose one decision you have this week. Combine your styles for the best outcome.",
      "<em>A Trust Check-in:</em> Ask, “When do you feel most respected in our decision-making?”"
    ])}

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Respect & Recognition</h4>
    <div class="verse">${scripture.respectRecognition}</div>
    <p class="intro-text">This dynamic shines a light on how you both value, affirm, and truly see each other for who you are. It explores how you seek to be known, understood, and deeply appreciated, and in turn, how you honor your spouse’s unique identity and contributions. At its heart, this is where you answer the profound question: <em>“Do you value me?”</em></p>
    ${rrCard(A)}
    ${rrCard(B)}
    ${promptsBlock([
      "<em>A \\\"High Five\\\" Moment:</em> Share a specific time you felt appreciated this week.",
      "<em>The \\\"One Thing\\\" Challenge:</em> Each choose one concrete way to honor your spouse this week."
    ])}
  `;

  /* ===== Section 3 ===== */
  const aToB = conflictStrategies[A.bondingKey][B.bondingKey];
  const bToA = conflictStrategies[B.bondingKey][A.bondingKey];

  container.innerHTML += `
    <div class="section-divider"></div>
    <h3 class="section-title">Section 3: Connection Patterns</h3>
    <div class="verse">${scripture.connectionPattern}</div>
    <p class="intro-text">Everyone has a unique pattern for how they approach connection and conflict. Your results here will illuminate how you tend to respond to perceived conflict and how you desire to repair after it. Learning about your own strengths, challenges, and weaknesses in this area is key to building a healthier, more resilient relationship. We hope these results provide a helpful starting point for a deeper conversation with your spouse.</p>
    <div class="couple-grid">
      ${patternColumn(A)}
      ${patternColumn(B)}
    </div>

    <div class="subsection-divider"></div>
    <h4 class="subsection-title">Personalized Conflict Resolution Strategies</h4>
    <div class="verse">${scripture.conflictStrategies}</div>
    ${strategyCard(A.name, B.name, B.bondingKey, aToB)}
    ${strategyCard(B.name, A.name, A.bondingKey, bToA)}

    <div class="section-divider"></div>
    <div class="result-block" style="border-left-color:transparent; background:#fff;">
      <h3 class="thank-title">Thank You</h3>
      <div class="verse">${scripture.thankYou}</div>
      <p class="intro-text">We hope you had fun diving deep and discovering your unique connection types on multiple levels!</p>
      <p class="intro-text">Remember, this has been a friendly, beginner’s assessment, designed not to label you, but to inspire the sparks of connection and help your marriage explore the beautiful, unique individuals within it. Use these insights as a fun tool for introspection and spouse discovery, opening up new conversations and drawing you closer.</p>
      <p class="intro-text">To be truly known is to unlock the deepest intimacy—embracing what’s true today and boldly aiming for what’s possible tomorrow, cultivating the lasting love and joy-filled fulfillment God designed for your marriage.</p>
    </div>
  `;

  document.getElementById('results').innerHTML = "";
  document.getElementById('results').appendChild(container);
}

/* ---------- results helpers ---------- */
function typesColumn(name, types){
  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${name}</div>
      ${types.map(k=>`
        <div class="result-block" style="border-left-color:${typeColors[k]}; background:${typeOpac[k]};">
          <strong>${INTIMACY[k].label}</strong> — ${INTIMACY[k].desc}
        </div>
      `).join("")}
    </div></div>
  `;
}

function compassionColumn(p){
  const exp = p.expressedTop2.map(k=>{
    const acc = temperamentAccentFromAffKey(k);
    return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>Expressed:</strong> ${affEXP[k]}
    </div>`;
  }).join("");
  const des = p.desiredTop2.map(k=>{
    const acc = temperamentAccentFromAffKey(k);
    return `<div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>Most Loved:</strong> ${affDES[k]}
    </div>`;
  }).join("");
  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${p.name}</div>
      <div class="partner-subhead"><strong>${p.name} — You Express Love</strong></div>
      ${exp}
      <div class="partner-subhead"><strong>${p.name} — You Feel Most Loved</strong></div>
      ${des}
    </div></div>
  `;
}

function buildTemperamentText(topKey, summary){
  if(!topKey) return summary || "";
  const d = temperamentDetails[topKey] || {};
  return `${summary || ""} <br><em>What it looks like:</em> ${d.looks || ""} <br><em>Watch-outs:</em> ${d.watch || ""} <br><em>Helpful tip:</em> ${d.tip || ""}`;
}
function temperamentBlock(name, title, text, topKey){
  const acc = temperamentAccentFromKey(topKey);
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>${name} — ${title}:</strong> <span>${text}</span>
    </div>
  `;
}

/* Expanded Connection Pattern card */
function patternColumn(p){
  const accMap = {
    SteadyConnector:{ color: typeColors.Partnership,  bg: typeOpac.Partnership  },
    ReassuranceSeeker:{ color: typeColors.Emotional, bg: typeOpac.Emotional },
    IndependentConnector:{ color: typeColors.Intellectual, bg: typeOpac.Intellectual },
    GuardedConnector:{ color: typeColors.Conflict,   bg: typeOpac.Conflict   }
  };
  const acc = accMap[p.bondingKey] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" };
  const d = patternDetail[p.bondingKey];

  return `
    <div class="partner-card"><div class="partner-inner">
      <div class="partner-header">${p.name}</div>
      <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
        <p><strong>Connection Type:</strong> ${d.connectionType}</p>
        <p><strong>Strengths:</strong> You ${d.strengths}</p>
        <p><strong>Challenges:</strong> You ${d.challenges}</p>
        <p><strong>Tendencies in Conflict:</strong> ${d.tendencies}</p>
        <p><strong>Coping Skills:</strong> ${d.coping}</p>
      </div>
    </div></div>
  `;
}

/* Personalized strategy: use receiver's pattern for color and address by name */
function strategyCard(fromName, toName, toPatternKey, practicalTip){
  const accMap = {
    SteadyConnector:{ color: typeColors.Partnership,  bg: typeOpac.Partnership  },
    ReassuranceSeeker:{ color: typeColors.Emotional, bg: typeOpac.Emotional },
    IndependentConnector:{ color: typeColors.Intellectual, bg: typeOpac.Intellectual },
    GuardedConnector:{ color: typeColors.Conflict,   bg: typeOpac.Conflict   }
  };
  const acc = accMap[toPatternKey] || { color:"#4D9DE0", bg:"rgba(77,157,224,.08)" };
  const sentence = nameStrategy(fromName, toName, toPatternKey);
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>${fromName}, try this with ${toName}:</strong>
      <p style="margin:6px 0 0;">${sentence}</p>
      <p style="margin:6px 0 0;"><em>Practical move:</em> ${practicalTip}</p>
    </div>
  `;
}

/* Respect & Recognition helpers */
function rrAccent(label){
  if(label==="Strong")   return { color:typeColors.Partnership, bg:typeOpac.Partnership };
  if(label==="Moderate") return { color:typeColors.Commitment,  bg:typeOpac.Commitment  };
  return { color:typeColors.Emotional, bg:typeOpac.Emotional };
}
function rrCard(p){
  const acc = rrAccent(p.rrLabel);
  return `
    <div class="result-block" style="border-left-color:${acc.color}; background:${acc.bg};">
      <strong>${p.name} — Respect &amp; Recognition:</strong> ${p.rrLabel} (${p.rrScore}/6)
      <p style="margin:8px 0 0;">${rrStatement(p.rrScore)}</p>
    </div>
  `;
}
function rrStatement(score){
  if(score>=5) return "You generally feel affirmed, appreciated, respected, and validated—and you likely offer the same in return.";
  if(score>=3) return "You often feel appreciated and respected, though there may be moments when clearer affirmation would be meaningful.";
  return "You may not consistently feel affirmed or validated; be explicit about the kinds of appreciation that help you feel respected.";
}

/* Prompts */
function promptsBlock(items){
  return `
    <div class="prompt-block">
      <strong>Discussion Prompts</strong>
      <ul class="results-list" style="margin-top:6px;">
        ${items.map(li=>`<li>${li}</li>`).join("")}
      </ul>
    </div>
  `;
}
</script>
</body>
</html>
